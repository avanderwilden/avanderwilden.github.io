"0","library(tidyverse)"
"0","library(lubridate)"
"0","library(gt)"
"0",""
"0","df_s <- read_csv('subscriptions_2024_03_01.csv') #CHANGE HERE"
"0","roku <- read_csv('roku_subscriptions_2024_03_01.csv') %>% #CHANGE HERE"
"0","  filter(sub_start_date >= mdy('1/17/23')) %>% "
"0","  filter(!is.na(email))"
"0",""
"0","df <- df_s %>% "
"0","  full_join(roku) %>% "
"0","  mutate(sdc = ifelse(sub_start_date == canceled_at, 1, 0))"
"0",""
"0","wk_no <- 9 # CHANGE HERE"
"0","wk_no_off <- 9  # CHANGE HERE"
"0","wk_range <- c(mdy('02/25/24'):mdy('03/02/24')) # CHANGE HERE"
"0","wk_end_epi <- mdy('03/01/24') # CHANGE HERE"
"0",""
"0","cancel <- df %>% "
"0","  filter(!is.na(canceled_at)) %>% "
"0","  count(canceled_at) %>% "
"0","  mutate(month = month(canceled_at, label = T, abbr = F)) "
"0",""
"0",""
"0","churn <- df %>% "
"0","  filter(!is.na(churn_date)) %>% "
"0","  count(churn_date) %>% "
"0","  mutate(month = month(churn_date, label = T, abbr = F)) "
"0",""
"0",""
"0","subs <- df %>% "
"0","  count(sub_start_date) %>% "
"0","  mutate(month = month(sub_start_date, label = T, abbr = F)) %>% "
"0","  filter(sub_start_date != today())"
"0",""
"0",""
"0","churn_2 <- churn %>% "
"0","  select(-month) %>% "
"0","  rename(churns = n)"
"0",""
"0","cancel_2 <- cancel %>% "
"0","  select(-month) %>% "
"0","  rename(cancels = n )"
"0",""
"0","sdc <- df %>% "
"0","  group_by(sub_start_date) %>% "
"0","  summarise(sdc = sum(sdc, na.rm = T))"
"0",""
"0","  "
"0","subs_2 <- df %>%"
"0","  count(sub_start_date) %>%"
"0","  mutate(date = sub_start_date,"
"0","         month = month(date, label = T, abbr = F),"
"0","         total_subs = cumsum(n)) %>% "
"0","  select(-sub_start_date) %>% "
"0","  rename(subscriptions = n) %>% "
"0","  relocate(date) %>% "
"0","  full_join(churn_2, by = c('date' = 'churn_date')) %>% "
"0","  full_join(cancel_2, by = c('date' = 'canceled_at')) %>%"
"0","  full_join(sdc, by = c('date' = 'sub_start_date')) %>% "
"0","  mutate(churns = ifelse(is.na(churns),0,churns),"
"0","         cancels = ifelse(is.na(cancels),0,cancels),"
"0","         sdc = ifelse(is.na(sdc),0, sdc),"
"0","         total_churns = cumsum(churns),"
"0","         active_subs = total_subs - total_churns,"
"0","         churn_pct = churns/active_subs,"
"0","         cancel_pct = cancels/active_subs,"
"0","         subs_pct = subscriptions/active_subs) %>% "
"0","  filter(date < wk_end_epi & date >= mdy('6/1/2022')) %>% "
"0","  mutate(weekday = weekdays(date),"
"0","         .after = month)"
"0",""
"0","subs_2 <- subs_2 %>% "
"0","  filter(date <= wk_end_epi) %>% "
"0","  mutate(wk_no = epiweek(date),"
"0","         year = year(date),"
"0","         subs_rank = rank(desc(subscriptions),"
"0","                          ties.method = 'last'),"
"0","         churn_rank = rank(desc(churns),"
"0","                          ties.method = 'last'),"
"0","         cancel_rank = rank(desc(cancels),"
"0","                          ties.method = 'last'))"
"0","  "
"0",""
"0","asdf <- subs_2 %>%"
"0","  group_by(epiyear(date), wk_no) %>%"
"0","  summarise(subs = sum(subscriptions),"
"0","            churns = sum(churns),"
"0","            cancels = sum(cancels),"
"0","            sdc = sum(sdc),"
"0","            eow_active = active_subs[which.max(date)],"
"0","            wk_start = min(date),"
"0","            wk_end = max(date)) %>% "
"0","  rename(year = 1) %>% "
"0","  arrange(year, wk_no) %>% "
"0","  ungroup() %>% "
"0","  filter(wk_start <= wk_end_epi) %>% "
"0","  mutate(net_subs = subs - churns,"
"0","         subs_rank = rank(desc(subs),ties.method = 'last'),"
"0","         churn_rank = rank(desc(churns), ties.method = 'last'),"
"0","         cancel_rank = rank(desc(cancels), ties.method = 'last'))"
